(()=>{"use strict";var t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button__inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};function e(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function n(n,o){!function(t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity("")}(o),o.validity.valid?e(n,o,t):function(t,e,n,o){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(n,o,o.validationMessage,t)}function o(t,n){var o=Array.from(t.querySelectorAll(n.inputSelector)),c=t.querySelector(n.submitButtonSelector);c.setAttribute("disabled",""),c.classList.add(n.inactiveButtonClass),o.forEach((function(o){e(t,o,n)}))}var c=document.querySelector(".page"),r=Array.from(document.querySelectorAll(".popup"));function a(t){t.classList.add("popup_is-opened"),c.addEventListener("mousedown",u),c.addEventListener("keydown",s)}function i(){r.forEach((function(t){t.classList.remove("popup_is-opened")})),c.removeEventListener("click",u),c.removeEventListener("keydown",s)}function u(t){r.includes(t.target)&&i()}function s(t){"Escape"===t.key&&i()}function l(e){e.reset(),o(e,t),i()}var d={url:"https://nomoreparties.co/v1/wff-cohort-15",headers:{authorization:"0eca1750-b436-4916-b371-28c42c11999a","Content-Type":"application/json"},myId:"6d74a5bea09caca2faf33cbc"};var p=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),m=document.querySelector(".profile__image");function _(t){p.textContent=t.name,f.textContent=t.about}function h(t){t.owner._id!=="".concat(d.myId)?t.owner.me=!1:t.owner.me=!0}function v(t,e,n){e.querySelector(".popup__button").textContent=t?n.true:n.false}function y(t,e){e.querySelector(".card__like-quantity").textContent=t}var S={true:"Сохранение...",false:"Сохранить"},k={true:"Удаление...",false:"Да"};function q(t){t.classList.toggle("card__like-button_is-active");var e=t.closest(".card");!function(t,e,n){t.classList.contains("card__like-button_is-active")?function(t,e){fetch("".concat(d.url,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:"".concat(d.headers.authorization)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){y(t.likes.length,e)})).catch((function(t){console.log(t)}))}(e,n):function(t,e){fetch("".concat(d.url,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:"".concat(d.headers.authorization)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){y(t.likes.length,e)})).catch((function(t){console.log(t)}))}(e,n)}(t,e.getAttribute("data-card-id"),e)}var b=document.querySelector(".popup_type_image"),E=document.querySelector(".popup__image"),C=document.querySelector(".popup__caption");function g(t){E.src=t.link,E.alt=t.name,C.textContent=t.name,a(b)}var L=document.querySelector("#card-template").content,z=document.querySelector(".places__list");function A(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"append",n=function(t,e,n,o){var c=L.querySelector(".card").cloneNode(!0),r=c.querySelector(".card__image"),a=c.querySelector(".card__title"),i=c.querySelector(".card__like-quantity");r.src=t.link,r.alt=t.name,a.textContent=t.name,i.textContent=t.likes.length;var u=c.querySelector(".card__delete-button");c.setAttribute("data-card-id",t._id),t.owner.me?u.addEventListener("click",(function(t){var e=t.target.closest(".card"),n=e.getAttribute("data-card-id");P(e,n)})):u.remove();var s=t.likes.some((function(t){return t._id=="".concat(d.myId)})),l=c.querySelector(".card__like-button");return l.addEventListener("click",(function(){n(l)})),s?l.classList.add("card__like-button_is-active"):l.classList.remove("card__like-button_is-active"),r.addEventListener("click",(function(){return o(t)})),c}(t,0,q,g);z[e](n)}var T=document.querySelector(".popup_type_delete-card"),j=T.querySelector(".popup__button");function P(t,e){a(T),j.addEventListener("click",(function(){!function(t,e){v(!0,T,k),fetch("".concat(d.url,"/cards/").concat(e),{method:"DELETE",headers:{authorization:"".concat(d.headers.authorization)}}).then((function(e){return e.ok&&(t.remove(),i(),v(!1,T,k)),Promise.reject("Ошибка: ".concat(e.status))})).catch((function(t){console.log(t)}))}(t,e)}))}fetch("".concat(d.url,"/users/me"),{headers:{authorization:"".concat(d.headers.authorization)},method:"GET"}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){_(t),m.style="background-image: url(".concat(t.avatar,")")})).catch((function(t){console.log(t)})),fetch("".concat(d.url,"/cards"),{headers:{authorization:"".concat(d.headers.authorization),"Content-Type":"".concat(d.headers["Content-Type"])},method:"GET"}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){t.forEach((function(t){h(t),A(t,"append")}))})).catch((function(t){console.log(t)})),r.forEach((function(t){t.classList.add("popup_is-animated")})),document.querySelectorAll(".popup__close").forEach((function(t){t.addEventListener("click",i)}));var x=document.querySelector(".profile__edit-button"),w=document.querySelector(".popup_type_edit"),B=document.forms["edit-profile"],D=document.querySelector(".popup__input_type_name"),N=document.querySelector(".popup__input_type_description");x.addEventListener("click",(function(){D.value=p.textContent,N.value=f.textContent,o(B,t),a(w)})),B.addEventListener("submit",(function(t){t.preventDefault(),function(t,e,n,o){v(!0,n,S),fetch("".concat(d.url,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(d.headers.authorization),"Content-Type":"".concat(d.headers["Content-Type"])},body:JSON.stringify({name:t,about:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){v(!1,n,S),_(t),o(n)})).catch((function(t){console.log(t)}))}(D.value,N.value,B,l)}));var O=document.querySelector(".popup_type_new-card"),I=document.querySelector(".profile__add-button"),J=document.forms["new-place"],M=document.querySelector(".popup__input_type_card-name"),G=document.querySelector(".popup__input_type_url");I.addEventListener("click",(function(){a(O),J.reset(),o(J,t)})),J.addEventListener("submit",(function(t){t.preventDefault();var e={};e.name=M.value,e.link=G.value,e.me=!0,function(t,e,n,o){v(!0,e,S),fetch("".concat(d.url,"/cards"),{method:"POST",headers:{authorization:"".concat(d.headers.authorization),"Content-Type":"".concat(d.headers["Content-Type"])},body:JSON.stringify({name:t.name,link:t.link})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){h(t),n(t,"prepend"),v(!1,e,S),o(e)})).catch((function(t){console.log(t)}))}(e,J,A,l)}));var H=document.querySelector(".profile__image"),V=document.querySelector(".popup_type_avatar"),U=document.forms.avatar;H.addEventListener("click",(function(){U.reset(),o(U,t),a(V)})),U.addEventListener("submit",(function(t){t.preventDefault(),function(t,e,n){v(!0,e,S),fetch("".concat(d.url,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(d.headers.authorization),"Content-Type":"".concat(d.headers["Content-Type"])},body:JSON.stringify({avatar:t})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){m.style="background-image: url(".concat(t.avatar,")"),v(!1,e,S),n(e)})).catch((function(t){console.log(t)}))}(U.link.value,U,l)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),c=t.querySelector(e.submitButtonSelector);o.forEach((function(r){r.addEventListener("input",(function(){n(t,r),function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.removeAttribute("disabled",""),e.classList.remove(n.inactiveButtonClass)):(e.setAttribute("disabled",""),e.classList.add(n.inactiveButtonClass))}(o,c,e)}))}))}(e,t)}))}(t)})();